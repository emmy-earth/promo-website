<!-- Navigation -->
{% assign current_url = page.url %}
{% assign is_home = false %}
{% assign is_business_case = false %}
{% assign is_mission = false %}
{% assign is_contact = false %}

{% if current_url == '/' %}
  {% assign is_home = true %}
{% endif %}
{% if current_url == '/business-case/' %}
  {% assign is_business_case = true %}
{% endif %}
{% if current_url == '/mission/' %}
  {% assign is_mission = true %}
{% endif %}
{% if current_url == '/contact/' %}
  {% assign is_contact = true %}
{% endif %}

{% capture nav_link_base -%}
inline-flex items-center gap-1.5 rounded-full px-3 py-2 text-sm font-medium text-slate-600 bg-transparent transition-colors duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F2CBAE]
{%- endcapture %}

{% capture dropdown_link_base -%}
flex items-center justify-between gap-3 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 transition-colors duration-200 hover:bg-slate-100 hover:text-slate-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F2CBAE]
{%- endcapture %}

<header x-data="navData()" class="sticky top-0 z-50 border-b border-slate-200 bg-white/95 backdrop-blur">
  <nav class="mx-auto flex max-w-6xl flex-col gap-3 px-4 sm:px-6 md:h-20 md:flex-row md:items-center md:justify-between md:gap-6">
    <div class="flex h-16 w-full items-center justify-between md:h-auto md:w-auto md:flex-none">
      <a href="{{ site.baseurl }}/" class="shrink-0">
        <img src="{{ site.baseurl }}/assets/images/PPT_Rectangle logo_10.11.2025.png" alt="Emmy.earth" class="h-11 w-auto" />
      </a>

      <div class="flex items-center gap-3 md:hidden">
        <a href="{{ site.baseurl }}/contact/" class="inline-flex items-center justify-center rounded-full border border-emerald-400 bg-emerald-400 px-4 py-2 text-xs font-semibold uppercase tracking-[0.28em] text-white transition hover:bg-emerald-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-400">
          Demo
        </a>
        <button @click="menuOpen = !menuOpen" :aria-expanded="menuOpen" aria-controls="nav3Menu" class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-slate-300 bg-white text-slate-600 transition hover:text-slate-900 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F2CBAE]">
          <span class="sr-only">Toggle navigation</span>
          <svg x-show="!menuOpen" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="7" x2="20" y2="7" />
            <line x1="4" y1="12" x2="20" y2="12" />
            <line x1="4" y1="17" x2="20" y2="17" />
          </svg>
          <svg x-show="menuOpen" x-cloak class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <line x1="6" y1="6" x2="18" y2="18" />
            <line x1="18" y1="6" x2="6" y2="18" />
          </svg>
        </button>
      </div>
    </div>

    <div id="nav3Menu" x-show="menuOpen" x-transition class="w-full flex-col items-start gap-4 pb-6 md:flex md:flex-1 md:flex-row md:items-center md:justify-between md:gap-6 md:pb-0">
      <ul class="flex w-full flex-col gap-2 md:flex-row md:items-center md:gap-4">

        <li class="relative" x-data="{ dropdownOpen: false }">
          <button @click="dropdownOpen = !dropdownOpen" :aria-expanded="dropdownOpen" class="{{ nav_link_base | strip }} cursor-pointer hover:bg-[#F2CBAE] hover:text-slate-900 pr-9">
            <span>Solutions</span>
            <svg :class="{ 'rotate-180': dropdownOpen }" class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 transition-transform duration-200" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 7.5L10 12.5L15 7.5" />
            </svg>
          </button>
          <div x-show="dropdownOpen" x-transition @click.away="dropdownOpen = false" x-cloak class="absolute left-0 right-auto z-40 mt-2 min-w-[14rem] flex-col gap-1 rounded-xl border border-slate-200 bg-white p-3 shadow-lg md:left-1/2 md:-translate-x-1/2">
            <a href="{{ site.baseurl }}/#scope1-2" class="{{ dropdown_link_base | strip }}">
              <span>GHG scope 1&amp;2</span>
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
            <a href="{{ site.baseurl }}/#scope3" class="{{ dropdown_link_base | strip }}">
              <span>GHG scope 3</span>
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
            <a href="{{ site.baseurl }}/#other-services" class="{{ dropdown_link_base | strip }}">
              <span>Other services</span>
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
          </div>
        </li>
        <li>
          <a data-nav3-link href="{{ site.baseurl }}/business-case/" data-active="{% if is_business_case %}true{% else %}false{% endif %}" class="{{ nav_link_base | strip }} {% unless is_business_case %}hover:bg-[#F2CBAE] hover:text-slate-900{% endunless %} {% if is_business_case %}bg-[#F2CBAE] text-slate-900 shadow-sm{% endif %}">
            Business case
          </a>
        </li>
        <li>
          <a data-nav3-link href="{{ site.baseurl }}/mission/" data-active="{% if is_mission %}true{% else %}false{% endif %}" class="{{ nav_link_base | strip }} {% unless is_mission %}hover:bg-[#F2CBAE] hover:text-slate-900{% endunless %} {% if is_mission %}bg-[#F2CBAE] text-slate-900 shadow-sm{% endif %}">
            Pricing
          </a>
        </li>
        <li>
          <a data-nav3-link href="{{ site.baseurl }}/contact/" data-active="{% if is_contact %}true{% else %}false{% endif %}" class="{{ nav_link_base | strip }} {% unless is_contact %}hover:bg-[#F2CBAE] hover:text-slate-900{% endunless %} {% if is_contact %}bg-[#F2CBAE] text-slate-900 shadow-sm{% endif %}">
            Contact
          </a>
        </li>
      </ul>

      <div class="flex w-full flex-col items-stretch gap-3 border-t border-slate-200 pt-4 md:w-auto md:flex-row md:items-center md:gap-4 md:border-t-0 md:pt-0">
        <a href="{{ site.baseurl }}/start-for-free/" class="inline-flex items-center justify-center whitespace-nowrap rounded-full px-6 py-2.5 text-sm font-semibold text-emerald-600 border border-emerald-600 bg-white shadow-lg transition hover:bg-emerald-50 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 hover:-translate-y-0.5">
          Start for free
        </a>
        <a href="{{ site.baseurl }}/contact/" class="inline-flex items-center justify-center whitespace-nowrap rounded-full px-6 py-2.5 text-sm font-semibold text-white shadow-lg transition focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 cta-primary hover:-translate-y-0.5">
          Get a demo
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  function navData() {
    return {
      menuOpen: false,
      init() {
        // Handle responsive menu behavior
        const mediaQuery = window.matchMedia('(min-width: 768px)');
        const syncMenu = (event) => {
          this.menuOpen = event.matches;
        };
        syncMenu(mediaQuery);
        mediaQuery.addEventListener('change', syncMenu);

        // Close menu on outside click (mobile only)
        document.addEventListener('click', (event) => {
          if (!this.$el.contains(event.target) && !mediaQuery.matches) {
            this.menuOpen = false;
          }
        });

        // Close menu on escape key
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && !mediaQuery.matches) {
            this.menuOpen = false;
          }
        });
      }
    }
  }
</script>
