<!-- Navigation -->
{% assign current_url = page.url %}
{% assign is_home = false %}
{% assign is_business_case = false %}
{% assign is_mission = false %}
{% assign is_contact = false %}

{% if current_url == '/' %}
  {% assign is_home = true %}
{% endif %}
{% if current_url == '/business-case/' %}
  {% assign is_business_case = true %}
{% endif %}
{% if current_url == '/mission/' %}
  {% assign is_mission = true %}
{% endif %}
{% if current_url == '/contact/' %}
  {% assign is_contact = true %}
{% endif %}

{% capture nav_link_base -%}
inline-flex items-center gap-1.5 rounded-full px-3 py-2 text-sm font-medium text-slate-600 bg-transparent transition-colors duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F2CBAE]
{%- endcapture %}

{% capture dropdown_link_base -%}
flex items-center justify-between gap-3 rounded-lg px-3 py-2 text-sm font-medium text-slate-600 transition-colors duration-200 hover:bg-slate-100 hover:text-slate-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F2CBAE]
{%- endcapture %}

<header x-data="navData()" class="sticky top-0 z-50 border-b border-slate-200 bg-white/95 backdrop-blur">
  <nav class="mx-auto flex max-w-6xl flex-col gap-3 px-4 sm:px-6 md:h-20 md:flex-row md:items-center md:justify-between md:gap-6">
    <div class="flex h-16 w-full items-center justify-between md:h-auto md:w-auto md:flex-none">
      <a href="{{ site.baseurl }}/" class="shrink-0">
        <img src="{{ site.baseurl }}/assets/images/Canvas_Rectangle logo_6.11.2025.png" alt="Emmy.earth" class="h-9 w-auto" />
      </a>

      <div class="flex items-center gap-3 md:hidden">
        <!-- Existing Demo button for mobile -->
        <a href="{{ site.baseurl }}/contact/" class="inline-flex items-center justify-center rounded-full border border-emerald-400 bg-emerald-400 px-4 py-2 text-xs font-semibold uppercase tracking-[0.28em] text-white transition hover:bg-emerald-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-400">
          Demo
        </a>
        <!-- NEW: Try for Free button for mobile -->
        <button @click="$dispatch('open-trial-modal')" class="inline-flex items-center justify-center rounded-full border border-emerald-400 bg-emerald-400 px-4 py-2 text-xs font-semibold uppercase tracking-[0.28em] text-white transition hover:bg-emerald-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-400">
          Try for Free
        </button>
        <button @click="menuOpen = !menuOpen" :aria-expanded="menuOpen" aria-controls="nav3Menu" class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-slate-300 bg-white text-slate-600 transition hover:text-slate-900 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F2CBAE]">
          <span class="sr-only">Toggle navigation</span>
          <svg x-show="!menuOpen" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="7" x2="20" y2="7" />
            <line x1="4" y1="12" x2="20" y2="12" />
            <line x1="4" y1="17" x2="20" y2="17" />
          </svg>
          <svg x-show="menuOpen" x-cloak class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <line x1="6" y1="6" x2="18" y2="18" />
            <line x1="18" y1="6" x2="6" y2="18" />
          </svg>
        </button>
      </div>
    </div>

    <div id="nav3Menu" x-show="menuOpen" x-transition class="w-full flex-col items-start gap-4 pb-6 md:flex md:flex-1 md:flex-row md:items-center md:justify-between md:gap-6 md:pb-0">
      <ul class="flex w-full flex-col gap-2 md:flex-row md:items-center md:gap-4">
        <li>
          <a data-nav3-link href="{{ site.baseurl }}/" data-active="{% if is_home %}true{% else %}false{% endif %}" class="{{ nav_link_base | strip }} {% unless is_home %}hover:bg-[#F2CBAE] hover:text-slate-900{% endunless %} {% if is_home %}bg-[#F2CBAE] text-slate-900 shadow-sm{% endif %}">
            Home
          </a>
        </li>
        <li class="relative" x-data="{ dropdownOpen: false }">
          <button @click="dropdownOpen = !dropdownOpen" :aria-expanded="dropdownOpen" class="{{ nav_link_base | strip }} cursor-pointer hover:bg-[#F2CBAE] hover:text-slate-900 pr-9">
            <span>Solutions</span>
            <svg :class="{ 'rotate-180': dropdownOpen }" class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 transition-transform duration-200" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 7.5L10 12.5L15 7.5" />
            </svg>
          </button>
          <div x-show="dropdownOpen" x-transition @click.away="dropdownOpen = false" x-cloak class="absolute left-0 right-auto z-40 mt-2 min-w-[14rem] flex-col gap-1 rounded-xl border border-slate-200 bg-white p-3 shadow-lg md:left-1/2 md:-translate-x-1/2">
            <a href="{{ site.baseurl }}/#scope1-2" class="{{ dropdown_link_base | strip }}">
              <span>GHG scope 1&amp;2</span>
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
            <a href="{{ site.baseurl }}/#scope3" class="{{ dropdown_link_base | strip }}">
              <span>GHG scope 3</span>
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
            <a href="{{ site.baseurl }}/#other-services" class="{{ dropdown_link_base | strip }}">
              <span>Other services</span>
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
          </div>
        </li>
        <li>
          <a data-nav3-link href="{{ site.baseurl }}/business-case/" data-active="{% if is_business_case %}true{% else %}false{% endif %}" class="{{ nav_link_base | strip }} {% unless is_business_case %}hover:bg-[#F2CBAE] hover:text-slate-900{% endunless %} {% if is_business_case %}bg-[#F2CBAE] text-slate-900 shadow-sm{% endif %}">
            Business case
          </a>
        </li>
        <li>
          <a data-nav3-link href="{{ site.baseurl }}/mission/" data-active="{% if is_mission %}true{% else %}false{% endif %}" class="{{ nav_link_base | strip }} {% unless is_mission %}hover:bg-[#F2CBAE] hover:text-slate-900{% endunless %} {% if is_mission %}bg-[#F2CBAE] text-slate-900 shadow-sm{% endif %}">
            Our mission
          </a>
        </li>
        <li>
          <a data-nav3-link href="{{ site.baseurl }}/contact/" data-active="{% if is_contact %}true{% else %}false{% endif %}" class="{{ nav_link_base | strip }} {% unless is_contact %}hover:bg-[#F2CBAE] hover:text-slate-900{% endunless %} {% if is_contact %}bg-[#F2CBAE] text-slate-900 shadow-sm{% endif %}">
            Contact
          </a>
        </li>
      </ul>

      <div class="flex w-full flex-col items-stretch gap-3 border-t border-slate-200 pt-4 md:w-auto md:flex-row md:items-center md:gap-4 md:border-t-0 md:pt-0">
        <a href="mailto:info@emmy.earth" class="inline-flex items-center justify-center rounded-full border border-slate-300 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-[#F2CBAE] hover:text-slate-900 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#F2CBAE] md:hidden">
          info@emmy.earth
        </a>
        <!-- NEW: Try for Free button for desktop -->
        <button @click="$dispatch('open-trial-modal')" class="inline-flex items-center justify-center whitespace-nowrap rounded-full px-6 py-2.5 text-sm font-semibold text-white shadow-lg transition focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 bg-emerald-500 hover:bg-emerald-600">
          Try for Free
        </button>
        <a href="{{ site.baseurl }}/contact/" class="inline-flex items-center justify-center whitespace-nowrap rounded-full px-6 py-2.5 text-sm font-semibold text-white shadow-lg transition focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 cta-primary">
          Get a demo
        </a>
      </div>
    </div>
  </nav>
</header>

<!-- NEW: Trial Form Modal -->
<div x-data="{ open: false }" @open-trial-modal.window="open = true" x-show="open" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
  class="fixed inset-0 z-[100] overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-cloak>
  <div class="flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div x-show="open" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
      @click="open = false" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

    <!-- This element is to trick the browser into centering the modal contents. -->
    <span class="hidden sm:inline-block sm:h-screen sm:align-middle" aria-hidden="true">&#8203;</span>

    <div x-show="open" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100" x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
      class="relative inline-block transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle">
      <div class="absolute right-0 top-0 hidden pr-4 pt-4 sm:block">
        <button @click="open = false" type="button" class="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
          <span class="sr-only">Close</span>
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="sm:flex sm:items-start">
        <div class="mx-auto flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-emerald-100 sm:mx-0 sm:h-10 sm:w-10">
          <svg class="h-6 w-6 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.181m0 0l-3.181 3.181m0-4.992h4.992M15.827 8.215l-4.992 4.992m0 0l-3.181 3.181m0-4.992h4.992m4.992 0l-3.181 3.181m0 0l-3.181 3.181m0-4.992h4.992" />
          </svg>
        </div>
        <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
          <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Start your Free Trial</h3>
          <div class="mt-2">
            <p class="text-sm text-gray-500">Fill out the form below to get started with your free trial!</p>
            <!-- Your Form Goes Here -->
            <form action="YOUR_TRIAL_FORM_SUBMISSION_ENDPOINT" method="POST" class="mt-4">
              <div class="mb-4">
                <label for="trial-name" class="block text-slate-700 text-sm font-bold mb-2">Name:</label>
                <input type="text" id="trial-name" name="name" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline" required>
              </div>
              <div class="mb-4">
                <label for="trial-company" class="block text-slate-700 text-sm font-bold mb-2">Company:</label>
                <input type="text" id="trial-company" name="company" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline" required>
              </div>
              <div class="mb-4">
                <label for="trial-email" class="block text-slate-700 text-sm font-bold mb-2">Work Email:</label>
                <input type="email" id="trial-email" name="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline" required>
              </div>
              <div class="flex justify-end pt-4">
                <button type="button" @click="open = false" class="mr-3 inline-flex justify-center rounded-md bg-gray-200 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                  Cancel
                </button>
                <button type="submit" class="inline-flex justify-center rounded-md border border-transparent bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
                  Submit for Trial
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function navData() {
    return {
      menuOpen: false,
      init() {
        // Handle responsive menu behavior
        const mediaQuery = window.matchMedia('(min-width: 768px)');
        const syncMenu = (event) => {
          this.menuOpen = event.matches;
        };
        syncMenu(mediaQuery);
        mediaQuery.addEventListener('change', syncMenu);

        // Close menu on outside click (mobile only)
        document.addEventListener('click', (event) => {
          if (!this.$el.contains(event.target) && !mediaQuery.matches) {
            this.menuOpen = false;
          }
        });

        // Close menu on escape key
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && !mediaQuery.matches) {
            this.menuOpen = false;
          }
        });
      }
    }
  }
</script>
