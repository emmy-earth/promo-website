<!-- Tailwind Navigation (Bootstrap-style structure) -->
{% assign is_home = page.url == '/' %}
{% assign is_business_case = page.url == '/business-case/' %}
{% assign is_mission = page.url == '/mission/' %}
{% assign is_contact = page.url == '/contact/' %}
{% capture nav_link_classes -%}
inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm font-semibold text-slate-200/80 transition-colors duration-200 hover:text-emerald-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 data-[active=true]:text-emerald-100 data-[active=true]:bg-emerald-400/10
{%- endcapture %}
{% capture dropdown_link_classes -%}
flex items-center justify-between gap-3 rounded-xl px-3 py-2 text-left text-sm font-medium text-slate-200 transition-colors duration-200 hover:bg-emerald-400/15 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300
{%- endcapture %}

<header data-nav-root class="sticky top-0 z-50 bg-slate-950/95 backdrop-blur-sm shadow-[0_10px_30px_-20px_rgba(14,21,49,0.8)]">
  <nav class="mx-auto flex max-w-6xl flex-col px-4 sm:px-6">
    <div class="flex items-center justify-between gap-4 py-4 md:py-5">
      <a href="{{ site.baseurl }}/" class="flex items-center gap-3 rounded-2xl px-2 py-1.5 transition hover:bg-white/5 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
        <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/5 ring-1 ring-white/10">
          <img src="{{ site.baseurl }}/assets/images/logo_rectangle.png" alt="Emmy.earth" class="h-6 w-auto">
        </span>
        <span class="hidden sm:block text-base font-semibold text-white">Emmy.earth</span>
      </a>

      <div class="flex items-center gap-3 md:hidden">
        <a href="{{ site.baseurl }}/contact/" class="rounded-full border border-emerald-300/60 bg-emerald-400/20 px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-emerald-100 transition hover:bg-emerald-400/30 hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">Demo</a>
        <button type="button" data-nav-toggle aria-expanded="false" aria-controls="tailwindNavMenu" class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-white/15 bg-white/10 text-slate-200 transition hover:border-emerald-300/50 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
          <span class="sr-only">Toggle navigation</span>
          <svg data-nav-icon="open" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="7" x2="20" y2="7" />
            <line x1="4" y1="12" x2="20" y2="12" />
            <line x1="4" y1="17" x2="20" y2="17" />
          </svg>
          <svg data-nav-icon="close" class="hidden h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <line x1="6" y1="6" x2="18" y2="18" />
            <line x1="18" y1="6" x2="6" y2="18" />
          </svg>
        </button>
      </div>
    </div>

    <div id="tailwindNavMenu" data-nav-menu class="hidden flex-col gap-4 border-t border-white/10 py-4 md:flex md:flex-row md:items-center md:justify-between md:gap-6 md:border-t-0 md:py-0">
      <ul class="flex flex-col gap-2 text-sm md:flex-row md:items-center md:gap-4 lg:gap-6">
        <li>
          <a data-nav-link data-active="{% if is_home %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/" class="{{ nav_link_classes | strip }}">
            Home
          </a>
        </li>
        <li data-nav-dropdown class="relative">
          <button type="button" data-nav-dropdown-toggle aria-expanded="false" class="{{ nav_link_classes | strip }} pr-9 md:pr-8">
            <span class="pointer-events-none">Solutions</span>
            <svg data-nav-dropdown-icon class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 transition-transform duration-200" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 7.5L10 12.5L15 7.5" />
            </svg>
          </button>
          <div data-nav-dropdown-panel data-open="false" class="absolute left-0 right-auto z-40 mt-2 hidden min-w-[14rem] flex-col gap-2 rounded-2xl border border-white/10 bg-slate-950/95 p-3 shadow-xl md:left-1/2 md:-translate-x-1/2 md:p-4">
            <a href="{{ site.baseurl }}/#scope1-2" class="{{ dropdown_link_classes | strip }}">
              <span>GHG scope 1&amp;2</span>
              <svg class="h-4 w-4" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
            <a href="{{ site.baseurl }}/#scope3" class="{{ dropdown_link_classes | strip }}">
              <span>GHG scope 3</span>
              <svg class="h-4 w-4" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
            <a href="{{ site.baseurl }}/#other-services" class="{{ dropdown_link_classes | strip }}">
              <span>Other services</span>
              <svg class="h-4 w-4" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14L14 6" />
                <path d="M9 6H14V11" />
              </svg>
            </a>
          </div>
        </li>
        <li>
          <a data-nav-link data-active="{% if is_business_case %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/business-case/" class="{{ nav_link_classes | strip }}">
            Business case
          </a>
        </li>
        <li>
          <a data-nav-link data-active="{% if is_mission %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/mission/" class="{{ nav_link_classes | strip }}">
            Our mission
          </a>
        </li>
        <li>
          <a data-nav-link data-active="{% if is_contact %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/contact/" class="{{ nav_link_classes | strip }}">
            Contact
          </a>
        </li>
      </ul>

      <div class="flex flex-col items-stretch gap-3 md:flex-row md:items-center md:gap-4">
        <a href="mailto:info@emmy.earth" class="inline-flex items-center justify-center rounded-full border border-white/15 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-emerald-300/50 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 md:hidden">
          info@emmy.earth
        </a>
        <a href="{{ site.baseurl }}/contact/" class="inline-flex items-center justify-center rounded-full border border-emerald-300/60 bg-emerald-400/20 px-5 py-2 text-sm font-semibold text-emerald-50 shadow-[0_12px_30px_-20px_rgba(22,242,176,0.6)] transition hover:bg-emerald-400/30 hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
          Get a demo
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navRoot = document.querySelector('[data-nav-root]');
    if (!navRoot) return;

    const toggle = navRoot.querySelector('[data-nav-toggle]');
    const menu = navRoot.querySelector('[data-nav-menu]');
    const menuLinks = navRoot.querySelectorAll('[data-nav-link]');
    const openIcon = navRoot.querySelector('[data-nav-icon="open"]');
    const closeIcon = navRoot.querySelector('[data-nav-icon="close"]');
    const dropdownContainer = navRoot.querySelector('[data-nav-dropdown]');
    const dropdownToggle = navRoot.querySelector('[data-nav-dropdown-toggle]');
    const dropdownPanel = navRoot.querySelector('[data-nav-dropdown-panel]');
    const dropdownIcon = navRoot.querySelector('[data-nav-dropdown-icon]');
    const mediaQuery = window.matchMedia('(min-width: 768px)');

    const setMenuOpen = (open) => {
      if (!menu) return;
      if (open) {
        menu.classList.remove('hidden');
      } else if (!mediaQuery.matches) {
        menu.classList.add('hidden');
      }
      menu.dataset.open = open ? 'true' : 'false';

      if (toggle) {
        toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      }

      if (openIcon && closeIcon) {
        if (open) {
          openIcon.classList.add('hidden');
          closeIcon.classList.remove('hidden');
        } else {
          openIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        }
      }

      if (!open) {
        setDropdownOpen(false);
      }
    };

    const setDropdownOpen = (open) => {
      if (!dropdownPanel || !dropdownToggle) return;
      dropdownPanel.dataset.open = open ? 'true' : 'false';
      dropdownToggle.dataset.open = open ? 'true' : 'false';
      dropdownToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      dropdownPanel.classList.toggle('hidden', !open);
      if (dropdownIcon) {
        dropdownIcon.dataset.open = open ? 'true' : 'false';
        dropdownIcon.classList.toggle('rotate-180', open);
      }
    };

    if (toggle && menu) {
      toggle.addEventListener('click', () => {
        const isOpen = menu.dataset.open === 'true';
        setMenuOpen(!isOpen);
      });
    }

    menuLinks.forEach((link) => {
      link.addEventListener('click', () => {
        if (!mediaQuery.matches) {
          setMenuOpen(false);
        }
      });
    });

    const syncMenu = (event) => {
      if (event.matches) {
        menu.classList.remove('hidden');
        menu.dataset.open = 'true';
        if (toggle) {
          toggle.setAttribute('aria-expanded', 'false');
        }
        if (openIcon && closeIcon) {
          openIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        }
      } else {
        menu.classList.add('hidden');
        menu.dataset.open = 'false';
      }
      setDropdownOpen(false);
    };

    syncMenu(mediaQuery);
    mediaQuery.addEventListener('change', syncMenu);

    if (dropdownToggle && dropdownPanel) {
      dropdownToggle.addEventListener('click', (event) => {
        event.preventDefault();
        const isOpen = dropdownPanel.dataset.open === 'true';
        setDropdownOpen(!isOpen);
      });

      dropdownToggle.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          const isOpen = dropdownPanel.dataset.open === 'true';
          setDropdownOpen(!isOpen);
        } else if (event.key === 'Escape') {
          setDropdownOpen(false);
          dropdownToggle.blur();
        }
      });
    }

    if (dropdownContainer) {
      dropdownContainer.addEventListener('mouseenter', () => {
        if (mediaQuery.matches) {
          setDropdownOpen(true);
        }
      });

      dropdownContainer.addEventListener('mouseleave', () => {
        if (mediaQuery.matches) {
          setDropdownOpen(false);
        }
      });
    }

    document.addEventListener('click', (event) => {
      if (dropdownContainer && !dropdownContainer.contains(event.target)) {
        setDropdownOpen(false);
      }
      if (!navRoot.contains(event.target) && !mediaQuery.matches) {
        setMenuOpen(false);
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        setDropdownOpen(false);
        if (!mediaQuery.matches) {
          setMenuOpen(false);
        }
      }
    });
  });
</script>


