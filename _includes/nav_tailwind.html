<!-- Tailwind Navigation -->
{% assign is_home = page.url == '/' %}
{% assign is_business_case = page.url == '/business-case/' %}
{% assign is_mission = page.url == '/mission/' %}
{% assign is_contact = page.url == '/contact/' %}
{% capture nav_link_classes -%}
group relative inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm font-semibold text-slate-200/80 transition-colors duration-300 hover:text-emerald-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 data-[active=true]:text-emerald-100 data-[active=true]:bg-emerald-400/10 data-[active=true]:shadow-halo
{%- endcapture %}
<header data-nav-root data-menu-open="false" class="sticky top-0 z-50">
  <div class="pointer-events-none absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-emerald-200/40 to-transparent"></div>
  <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
    <div data-nav-surface data-scrolled="false" data-menu-open="false" class="group/nav relative isolate mx-auto mt-4 flex items-center justify-between gap-4 overflow-visible rounded-3xl border border-white/10 bg-white/[0.04] px-4 py-3 backdrop-blur-xl transition-all duration-500 ease-out data-[scrolled=true]:mt-2 data-[scrolled=true]:border-white/15 data-[scrolled=true]:bg-slate-950/82 data-[scrolled=true]:shadow-[0_20px_60px_-40px_rgba(14,21,49,0.85)] data-[menu-open=true]:border-emerald-300/50 data-[menu-open=true]:bg-slate-950/92 data-[menu-open=true]:shadow-aurora md:px-6 md:py-4">
      <div class="pointer-events-none absolute inset-0 -z-10 overflow-hidden rounded-[inherit]">
        <div class="absolute -inset-px bg-[radial-gradient(circle_at_top,rgba(22,242,176,0.35),rgba(22,242,176,0)_60%)] opacity-75 transition-opacity duration-700 group-data-[scrolled=true]/nav:opacity-45"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-emerald-400/10 via-transparent to-sky-500/15 opacity-0 transition-opacity duration-700 group-data-[menu-open=true]/nav:opacity-100"></div>
      </div>

      <a href="{{ site.baseurl }}/" class="group/brand relative flex items-center gap-3 rounded-2xl px-2 py-1.5 transition hover:bg-white/5 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300 md:px-3 md:py-2">
        <span class="relative inline-flex h-10 w-10 items-center justify-center rounded-full bg-slate-950/60 ring-1 ring-white/10 transition group-hover/brand:ring-emerald-300/50">
          <span class="pointer-events-none absolute inset-0 rounded-full bg-emerald-400/40 blur-xl opacity-0 transition-opacity duration-500 group-hover/brand:opacity-80"></span>
          <img src="{{ site.baseurl }}/assets/images/logo_rectangle.png" alt="Emmy.earth" class="h-6 w-auto">
        </span>
        <div class="hidden sm:flex flex-col leading-tight">
          <span class="font-light text-lg text-white">Emmy.earth</span>
          <span class="text-[0.62rem] font-semibold uppercase tracking-[0.45em] text-emerald-200/80">AI Carbon Analyst</span>
        </div>
      </a>

      <div class="flex items-center gap-3 md:hidden">
        <a href="{{ site.baseurl }}/contact/" class="inline-flex items-center justify-center rounded-full border border-emerald-300/50 bg-emerald-400/20 px-4 py-2 text-[0.7rem] font-semibold uppercase tracking-[0.36em] text-emerald-100 transition hover:bg-emerald-400/30 hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">Demo</a>
        <button type="button" data-nav-toggle aria-expanded="false" aria-controls="navTailwindMenu" class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-white/15 bg-white/[0.08] text-slate-200 transition hover:border-emerald-300/60 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
          <span class="sr-only">Toggle navigation</span>
          <svg data-nav-icon="open" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="7" x2="20" y2="7" />
            <line x1="4" y1="12" x2="20" y2="12" />
            <line x1="4" y1="17" x2="20" y2="17" />
          </svg>
          <svg data-nav-icon="close" class="hidden h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>

      <div id="navTailwindMenu" data-nav-menu data-open="false" class="absolute left-0 right-0 top-full z-40 hidden flex-col gap-6 rounded-3xl border border-white/10 bg-slate-950/95 p-6 shadow-card transition-all duration-500 md:static md:z-auto md:flex md:flex-1 md:flex-row md:items-center md:justify-end md:gap-8 md:border-0 md:bg-transparent md:p-0 md:shadow-none">
        <nav class="space-y-3 md:flex md:items-center md:gap-4 md:space-y-0 lg:gap-6">
          <a data-nav-link data-active="{% if is_home %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/" class="{{ nav_link_classes | strip }}">
            <span>Home</span>
          </a>
          <div class="relative" data-nav-dropdown>
            <button type="button" data-nav-dropdown-toggle aria-expanded="false" class="{{ nav_link_classes | strip }} pr-2">
              <span>Solutions</span>
              <svg data-nav-dropdown-icon class="h-4 w-4 transition-transform duration-300 data-[open=true]:rotate-180" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 7.5L10 12.5L15 7.5" />
              </svg>
            </button>
            <div data-nav-dropdown-panel data-open="false" class="hidden min-w-[14rem] flex-col gap-3 rounded-2xl border border-white/10 bg-slate-950/95 p-4 text-sm shadow-card ring-1 ring-white/10 transition duration-300 md:absolute md:left-1/2 md:mt-4 md:w-64 md:-translate-x-1/2 md:rounded-3xl md:bg-slate-950/92 md:p-5 md:shadow-aurora md:ring-emerald-300/25">
              <a data-nav-link href="{{ site.baseurl }}/#scope1-2" class="group/item flex items-start justify-between gap-3 rounded-2xl bg-white/5 px-4 py-3 text-left text-slate-200 transition hover:bg-emerald-400/15 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
                <div>
                  <p class="text-sm font-semibold text-white transition group-hover/item:text-emerald-100">GHG scope 1&amp;2</p>
                  <p class="mt-1 text-xs text-slate-400">Energy, fleet & on-site emissions.</p>
                </div>
                <span class="mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/15 text-xs text-emerald-200 transition group-hover/item:border-emerald-300/60 group-hover/item:text-emerald-100">
                  <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                    <path d="M6 14L14 6" />
                    <path d="M9 6H14V11" />
                  </svg>
                </span>
              </a>
              <a data-nav-link href="{{ site.baseurl }}/#scope3" class="group/item flex items-start justify-between gap-3 rounded-2xl bg-white/5 px-4 py-3 text-left text-slate-200 transition hover:bg-emerald-400/15 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
                <div>
                  <p class="text-sm font-semibold text-white transition group-hover/item:text-emerald-100">GHG scope 3</p>
                  <p class="mt-1 text-xs text-slate-400">Supplier spend, logistics & value chain.</p>
                </div>
                <span class="mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/15 text-xs text-emerald-200 transition group-hover/item:border-emerald-300/60 group-hover/item:text-emerald-100">
                  <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                    <path d="M6 14L14 6" />
                    <path d="M9 6H14V11" />
                  </svg>
                </span>
              </a>
              <a data-nav-link href="{{ site.baseurl }}/#other-services" class="group/item flex items-start justify-between gap-3 rounded-2xl bg-white/5 px-4 py-3 text-left text-slate-200 transition hover:bg-emerald-400/15 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
                <div>
                  <p class="text-sm font-semibold text-white transition group-hover/item:text-emerald-100">Other services</p>
                  <p class="mt-1 text-xs text-slate-400">CSRD, PCF/LCA & water management.</p>
                </div>
                <span class="mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/15 text-xs text-emerald-200 transition group-hover/item:border-emerald-300/60 group-hover/item:text-emerald-100">
                  <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                    <path d="M6 14L14 6" />
                    <path d="M9 6H14V11" />
                  </svg>
                </span>
              </a>
            </div>
          </div>
          <a data-nav-link data-active="{% if is_business_case %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/business-case/" class="{{ nav_link_classes | strip }}">
            <span>Business case</span>
          </a>
          <a data-nav-link data-active="{% if is_mission %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/mission/" class="{{ nav_link_classes | strip }}">
            <span>Our mission</span>
          </a>
          <a data-nav-link data-active="{% if is_contact %}true{% else %}false{% endif %}" href="{{ site.baseurl }}/contact/" class="{{ nav_link_classes | strip }}">
            <span>Contact</span>
          </a>
        </nav>

        <div class="grid gap-4 border-t border-white/10 pt-4 md:grid-flow-col md:items-center md:gap-4 md:border-l md:border-t-0 md:pl-6 md:pt-0">
          <p class="text-xs font-semibold uppercase tracking-[0.36em] text-slate-500 md:hidden">Let's talk</p>
          <a href="mailto:info@emmy.earth" class="inline-flex items-center justify-center rounded-full border border-white/15 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-emerald-300/60 hover:text-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">info@emmy.earth</a>
          <a href="{{ site.baseurl }}/contact/" class="inline-flex items-center justify-center rounded-full border border-emerald-300/60 bg-emerald-400/20 px-5 py-2 text-sm font-semibold text-emerald-50 shadow-[0_12px_35px_-20px_rgba(22,242,176,0.65)] transition hover:bg-emerald-400/30 hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300">
            Get a demo
          </a>
        </div>
      </div>
    </div>
  </div>
</header>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navRoot = document.querySelector('[data-nav-root]');
    if (!navRoot) return;

    const surface = navRoot.querySelector('[data-nav-surface]');
    const toggle = navRoot.querySelector('[data-nav-toggle]');
    const menu = navRoot.querySelector('[data-nav-menu]');
    if (!menu) return;

    const mediaQuery = window.matchMedia('(min-width: 768px)');
    const pointerQuery = window.matchMedia('(pointer: fine)');
    const menuLinks = navRoot.querySelectorAll('[data-nav-link]');
    const openIcon = navRoot.querySelector('[data-nav-icon="open"]');
    const closeIcon = navRoot.querySelector('[data-nav-icon="close"]');
    const dropdownContainer = navRoot.querySelector('[data-nav-dropdown]');
    const dropdownToggle = navRoot.querySelector('[data-nav-dropdown-toggle]');
    const dropdownPanel = navRoot.querySelector('[data-nav-dropdown-panel]');
    const dropdownIcon = navRoot.querySelector('[data-nav-dropdown-icon]');

    const setDropdownOpen = (open) => {
      if (!dropdownPanel || !dropdownToggle) return;
      dropdownPanel.dataset.open = open ? 'true' : 'false';
      dropdownToggle.dataset.open = open ? 'true' : 'false';
      dropdownToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      dropdownPanel.setAttribute('aria-hidden', open ? 'false' : 'true');
      if (dropdownIcon) {
        dropdownIcon.dataset.open = open ? 'true' : 'false';
      }
      if (open) {
        dropdownPanel.classList.remove('hidden');
        dropdownPanel.style.pointerEvents = 'auto';
      } else {
        dropdownPanel.classList.add('hidden');
        dropdownPanel.style.pointerEvents = '';
      }
    };

    const setMenuOpen = (open) => {
      const isDesktop = mediaQuery.matches;
      navRoot.dataset.menuOpen = open ? 'true' : 'false';
      if (surface) {
        surface.dataset.menuOpen = open ? 'true' : 'false';
      }
      if (open) {
        menu.classList.remove('hidden');
      } else if (!isDesktop) {
        menu.classList.add('hidden');
      }
      menu.dataset.open = open ? 'true' : 'false';

      if (toggle) {
        toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      }

      if (openIcon && closeIcon) {
        if (open) {
          openIcon.classList.add('hidden');
          closeIcon.classList.remove('hidden');
        } else {
          openIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        }
      }

      if (!open) {
        setDropdownOpen(false);
      }
    };

    const updateScrolledState = () => {
      const scrolled = window.scrollY > 16;
      navRoot.dataset.scrolled = scrolled ? 'true' : 'false';
      if (surface) {
        surface.dataset.scrolled = scrolled ? 'true' : 'false';
      }
    };

    updateScrolledState();
    window.addEventListener('scroll', updateScrolledState, { passive: true });

    if (toggle) {
      toggle.addEventListener('click', () => {
        const open = navRoot.dataset.menuOpen === 'true';
        setMenuOpen(!open);
      });
    }

    menuLinks.forEach((link) => {
      link.addEventListener('click', () => {
        if (!mediaQuery.matches) {
          setMenuOpen(false);
        }
      });
    });

    const syncMenuForViewport = (event) => {
      if (event.matches) {
        menu.classList.remove('hidden');
        menu.dataset.open = 'true';
        navRoot.dataset.menuOpen = 'false';
        if (surface) {
          surface.dataset.menuOpen = 'false';
        }
        if (toggle) {
          toggle.setAttribute('aria-expanded', 'false');
        }
        if (openIcon && closeIcon) {
          openIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        }
      } else {
        menu.dataset.open = 'false';
        navRoot.dataset.menuOpen = 'false';
        if (surface) {
          surface.dataset.menuOpen = 'false';
        }
        if (toggle) {
          toggle.setAttribute('aria-expanded', 'false');
        }
        menu.classList.add('hidden');
      }
      setDropdownOpen(false);
    };

    syncMenuForViewport(mediaQuery);
    mediaQuery.addEventListener('change', syncMenuForViewport);

    const canHoverDropdown = () => pointerQuery.matches && mediaQuery.matches;

    if (dropdownToggle && dropdownPanel) {
      dropdownToggle.addEventListener('click', (event) => {
        event.preventDefault();
        const isOpen = dropdownPanel.dataset.open === 'true';
        setDropdownOpen(!isOpen);
      });

      dropdownToggle.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          const isOpen = dropdownPanel.dataset.open === 'true';
          setDropdownOpen(!isOpen);
        } else if (event.key === 'Escape') {
          setDropdownOpen(false);
          dropdownToggle.blur();
        }
      });
    }

    if (dropdownContainer) {
      dropdownContainer.addEventListener('mouseenter', () => {
        if (canHoverDropdown()) {
          setDropdownOpen(true);
        }
      });

      dropdownContainer.addEventListener('mouseleave', () => {
        if (canHoverDropdown()) {
          setDropdownOpen(false);
        }
      });
    }

    pointerQuery.addEventListener('change', () => {
      setDropdownOpen(false);
    });

    document.addEventListener('click', (event) => {
      if (dropdownContainer && !dropdownContainer.contains(event.target)) {
        setDropdownOpen(false);
      }
      if (!navRoot.contains(event.target) && !mediaQuery.matches) {
        setMenuOpen(false);
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        setDropdownOpen(false);
        if (!mediaQuery.matches) {
          setMenuOpen(false);
        }
      }
    });
  });
</script>

